{"ast":null,"code":"/**\n * @file Module used to configure Transformers.js.\n * \n * **Example:** Disable remote models.\n * ```javascript\n * import { env } from '@xenova/transformers';\n * env.allowRemoteModels = false;\n * ```\n * \n * **Example:** Set local model path.\n * ```javascript\n * import { env } from '@xenova/transformers';\n * env.localModelPath = '/path/to/local/models/';\n * ```\n * \n * **Example:** Set cache directory.\n * ```javascript\n * import { env } from '@xenova/transformers';\n * env.cacheDir = '/path/to/cache/directory/';\n * ```\n * \n * @module env\n */\n\nimport fs from 'fs';\nimport path from 'path';\nimport url from 'url';\nimport { ONNX } from './backends/onnx.js';\nconst {\n  env: onnx_env\n} = ONNX;\nconst VERSION = '2.17.2';\n\n// Check if various APIs are available (depends on environment)\nconst WEB_CACHE_AVAILABLE = typeof self !== 'undefined' && 'caches' in self;\nconst FS_AVAILABLE = !isEmpty(fs); // check if file system is available\nconst PATH_AVAILABLE = !isEmpty(path); // check if path is available\n\nconst RUNNING_LOCALLY = FS_AVAILABLE && PATH_AVAILABLE;\nconst __dirname = RUNNING_LOCALLY ? path.dirname(path.dirname(url.fileURLToPath(import.meta.url))) : './';\n\n// Only used for environments with access to file system\nconst DEFAULT_CACHE_DIR = RUNNING_LOCALLY ? path.join(__dirname, '/.cache/') : null;\n\n// Set local model path, based on available APIs\nconst DEFAULT_LOCAL_MODEL_PATH = '/models/';\nconst localModelPath = RUNNING_LOCALLY ? path.join(__dirname, DEFAULT_LOCAL_MODEL_PATH) : DEFAULT_LOCAL_MODEL_PATH;\nif (onnx_env?.wasm) {\n  // Set path to wasm files. This is needed when running in a web worker.\n  // https://onnxruntime.ai/docs/api/js/interfaces/Env.WebAssemblyFlags.html#wasmPaths\n  // We use remote wasm files by default to make it easier for newer users.\n  // In practice, users should probably self-host the necessary .wasm files.\n  onnx_env.wasm.wasmPaths = RUNNING_LOCALLY ? path.join(__dirname, '/dist/') : `https://cdn.jsdelivr.net/npm/@xenova/transformers@${VERSION}/dist/`;\n}\n\n/**\n * Global variable used to control execution. This provides users a simple way to configure Transformers.js.\n * @property {Object} backends Expose environment variables of different backends,\n * allowing users to set these variables if they want to.\n * @property {string} __dirname Directory name of module. Useful for resolving local paths.\n * @property {string} version This version of Transformers.js.\n * @property {boolean} allowRemoteModels Whether to allow loading of remote files, defaults to `true`.\n * If set to `false`, it will have the same effect as setting `local_files_only=true` when loading pipelines, models, tokenizers, processors, etc.\n * @property {string} remoteHost Host URL to load models from. Defaults to the Hugging Face Hub.\n * @property {string} remotePathTemplate Path template to fill in and append to `remoteHost` when loading models.\n * @property {boolean} allowLocalModels Whether to allow loading of local files, defaults to `true`.\n * If set to `false`, it will skip the local file check and try to load the model from the remote host.\n * @property {string} localModelPath Path to load local models from. Defaults to `/models/`.\n * @property {boolean} useFS Whether to use the file system to load files. By default, it is `true` if available.\n * @property {boolean} useBrowserCache Whether to use Cache API to cache models. By default, it is `true` if available.\n * @property {boolean} useFSCache Whether to use the file system to cache files. By default, it is `true` if available.\n * @property {string} cacheDir The directory to use for caching files with the file system. By default, it is `./.cache`.\n * @property {boolean} useCustomCache Whether to use a custom cache system (defined by `customCache`), defaults to `false`.\n * @property {Object} customCache The custom cache to use. Defaults to `null`. Note: this must be an object which\n * implements the `match` and `put` functions of the Web Cache API. For more information, see https://developer.mozilla.org/en-US/docs/Web/API/Cache\n */\nexport const env = {\n  /////////////////// Backends settings ///////////////////\n  backends: {\n    // onnxruntime-web/onnxruntime-node\n    onnx: onnx_env,\n    // TensorFlow.js\n    tfjs: {}\n  },\n  __dirname,\n  version: VERSION,\n  /////////////////// Model settings ///////////////////\n  allowRemoteModels: true,\n  remoteHost: 'https://huggingface.co/',\n  remotePathTemplate: '{model}/resolve/{revision}/',\n  allowLocalModels: true,\n  localModelPath: localModelPath,\n  useFS: FS_AVAILABLE,\n  /////////////////// Cache settings ///////////////////\n  useBrowserCache: WEB_CACHE_AVAILABLE,\n  useFSCache: FS_AVAILABLE,\n  cacheDir: DEFAULT_CACHE_DIR,\n  useCustomCache: false,\n  customCache: null\n  //////////////////////////////////////////////////////\n};\n\n/**\n * @param {Object} obj\n * @private\n */\nfunction isEmpty(obj) {\n  return Object.keys(obj).length === 0;\n}","map":{"version":3,"names":["fs","path","url","ONNX","env","onnx_env","VERSION","WEB_CACHE_AVAILABLE","self","FS_AVAILABLE","isEmpty","PATH_AVAILABLE","RUNNING_LOCALLY","__dirname","dirname","fileURLToPath","import","meta","DEFAULT_CACHE_DIR","join","DEFAULT_LOCAL_MODEL_PATH","localModelPath","wasm","wasmPaths","backends","onnx","tfjs","version","allowRemoteModels","remoteHost","remotePathTemplate","allowLocalModels","useFS","useBrowserCache","useFSCache","cacheDir","useCustomCache","customCache","obj","Object","keys","length"],"sources":["/workspaces/calico/node_modules/@xenova/transformers/src/env.js"],"sourcesContent":["/**\n * @file Module used to configure Transformers.js.\n * \n * **Example:** Disable remote models.\n * ```javascript\n * import { env } from '@xenova/transformers';\n * env.allowRemoteModels = false;\n * ```\n * \n * **Example:** Set local model path.\n * ```javascript\n * import { env } from '@xenova/transformers';\n * env.localModelPath = '/path/to/local/models/';\n * ```\n * \n * **Example:** Set cache directory.\n * ```javascript\n * import { env } from '@xenova/transformers';\n * env.cacheDir = '/path/to/cache/directory/';\n * ```\n * \n * @module env\n */\n\nimport fs from 'fs';\nimport path from 'path';\nimport url from 'url';\n\nimport { ONNX } from './backends/onnx.js';\nconst { env: onnx_env } = ONNX;\n\nconst VERSION = '2.17.2';\n\n// Check if various APIs are available (depends on environment)\nconst WEB_CACHE_AVAILABLE = typeof self !== 'undefined' && 'caches' in self;\nconst FS_AVAILABLE = !isEmpty(fs); // check if file system is available\nconst PATH_AVAILABLE = !isEmpty(path); // check if path is available\n\nconst RUNNING_LOCALLY = FS_AVAILABLE && PATH_AVAILABLE;\n\nconst __dirname = RUNNING_LOCALLY\n    ? path.dirname(path.dirname(url.fileURLToPath(import.meta.url)))\n    : './';\n\n// Only used for environments with access to file system\nconst DEFAULT_CACHE_DIR = RUNNING_LOCALLY\n    ? path.join(__dirname, '/.cache/')\n    : null;\n\n// Set local model path, based on available APIs\nconst DEFAULT_LOCAL_MODEL_PATH = '/models/';\nconst localModelPath = RUNNING_LOCALLY\n    ? path.join(__dirname, DEFAULT_LOCAL_MODEL_PATH)\n    : DEFAULT_LOCAL_MODEL_PATH;\n\nif (onnx_env?.wasm) {\n    // Set path to wasm files. This is needed when running in a web worker.\n    // https://onnxruntime.ai/docs/api/js/interfaces/Env.WebAssemblyFlags.html#wasmPaths\n    // We use remote wasm files by default to make it easier for newer users.\n    // In practice, users should probably self-host the necessary .wasm files.\n    onnx_env.wasm.wasmPaths = RUNNING_LOCALLY\n        ? path.join(__dirname, '/dist/')\n        : `https://cdn.jsdelivr.net/npm/@xenova/transformers@${VERSION}/dist/`;\n}\n\n/**\n * Global variable used to control execution. This provides users a simple way to configure Transformers.js.\n * @property {Object} backends Expose environment variables of different backends,\n * allowing users to set these variables if they want to.\n * @property {string} __dirname Directory name of module. Useful for resolving local paths.\n * @property {string} version This version of Transformers.js.\n * @property {boolean} allowRemoteModels Whether to allow loading of remote files, defaults to `true`.\n * If set to `false`, it will have the same effect as setting `local_files_only=true` when loading pipelines, models, tokenizers, processors, etc.\n * @property {string} remoteHost Host URL to load models from. Defaults to the Hugging Face Hub.\n * @property {string} remotePathTemplate Path template to fill in and append to `remoteHost` when loading models.\n * @property {boolean} allowLocalModels Whether to allow loading of local files, defaults to `true`.\n * If set to `false`, it will skip the local file check and try to load the model from the remote host.\n * @property {string} localModelPath Path to load local models from. Defaults to `/models/`.\n * @property {boolean} useFS Whether to use the file system to load files. By default, it is `true` if available.\n * @property {boolean} useBrowserCache Whether to use Cache API to cache models. By default, it is `true` if available.\n * @property {boolean} useFSCache Whether to use the file system to cache files. By default, it is `true` if available.\n * @property {string} cacheDir The directory to use for caching files with the file system. By default, it is `./.cache`.\n * @property {boolean} useCustomCache Whether to use a custom cache system (defined by `customCache`), defaults to `false`.\n * @property {Object} customCache The custom cache to use. Defaults to `null`. Note: this must be an object which\n * implements the `match` and `put` functions of the Web Cache API. For more information, see https://developer.mozilla.org/en-US/docs/Web/API/Cache\n */\nexport const env = {\n    /////////////////// Backends settings ///////////////////\n    backends: {\n        // onnxruntime-web/onnxruntime-node\n        onnx: onnx_env,\n\n        // TensorFlow.js\n        tfjs: {},\n    },\n\n    __dirname,\n    version: VERSION,\n\n    /////////////////// Model settings ///////////////////\n    allowRemoteModels: true,\n    remoteHost: 'https://huggingface.co/',\n    remotePathTemplate: '{model}/resolve/{revision}/',\n\n    allowLocalModels: true,\n    localModelPath: localModelPath,\n    useFS: FS_AVAILABLE,\n\n    /////////////////// Cache settings ///////////////////\n    useBrowserCache: WEB_CACHE_AVAILABLE,\n\n    useFSCache: FS_AVAILABLE,\n    cacheDir: DEFAULT_CACHE_DIR,\n\n    useCustomCache: false,\n    customCache: null,\n    //////////////////////////////////////////////////////\n}\n\n\n/**\n * @param {Object} obj\n * @private\n */\nfunction isEmpty(obj) {\n    return Object.keys(obj).length === 0;\n}\n\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,EAAE,MAAM,IAAI;AACnB,OAAOC,IAAI,MAAM,MAAM;AACvB,OAAOC,GAAG,MAAM,KAAK;AAErB,SAASC,IAAI,QAAQ,oBAAoB;AACzC,MAAM;EAAEC,GAAG,EAAEC;AAAS,CAAC,GAAGF,IAAI;AAE9B,MAAMG,OAAO,GAAG,QAAQ;;AAExB;AACA,MAAMC,mBAAmB,GAAG,OAAOC,IAAI,KAAK,WAAW,IAAI,QAAQ,IAAIA,IAAI;AAC3E,MAAMC,YAAY,GAAG,CAACC,OAAO,CAACV,EAAE,CAAC,CAAC,CAAC;AACnC,MAAMW,cAAc,GAAG,CAACD,OAAO,CAACT,IAAI,CAAC,CAAC,CAAC;;AAEvC,MAAMW,eAAe,GAAGH,YAAY,IAAIE,cAAc;AAEtD,MAAME,SAAS,GAAGD,eAAe,GAC3BX,IAAI,CAACa,OAAO,CAACb,IAAI,CAACa,OAAO,CAACZ,GAAG,CAACa,aAAa,CAACC,MAAM,CAACC,IAAI,CAACf,GAAG,CAAC,CAAC,CAAC,GAC9D,IAAI;;AAEV;AACA,MAAMgB,iBAAiB,GAAGN,eAAe,GACnCX,IAAI,CAACkB,IAAI,CAACN,SAAS,EAAE,UAAU,CAAC,GAChC,IAAI;;AAEV;AACA,MAAMO,wBAAwB,GAAG,UAAU;AAC3C,MAAMC,cAAc,GAAGT,eAAe,GAChCX,IAAI,CAACkB,IAAI,CAACN,SAAS,EAAEO,wBAAwB,CAAC,GAC9CA,wBAAwB;AAE9B,IAAIf,QAAQ,EAAEiB,IAAI,EAAE;EAChB;EACA;EACA;EACA;EACAjB,QAAQ,CAACiB,IAAI,CAACC,SAAS,GAAGX,eAAe,GACnCX,IAAI,CAACkB,IAAI,CAACN,SAAS,EAAE,QAAQ,CAAC,GAC9B,qDAAqDP,OAAO,QAAQ;AAC9E;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMF,GAAG,GAAG;EACf;EACAoB,QAAQ,EAAE;IACN;IACAC,IAAI,EAAEpB,QAAQ;IAEd;IACAqB,IAAI,EAAE,CAAC;EACX,CAAC;EAEDb,SAAS;EACTc,OAAO,EAAErB,OAAO;EAEhB;EACAsB,iBAAiB,EAAE,IAAI;EACvBC,UAAU,EAAE,yBAAyB;EACrCC,kBAAkB,EAAE,6BAA6B;EAEjDC,gBAAgB,EAAE,IAAI;EACtBV,cAAc,EAAEA,cAAc;EAC9BW,KAAK,EAAEvB,YAAY;EAEnB;EACAwB,eAAe,EAAE1B,mBAAmB;EAEpC2B,UAAU,EAAEzB,YAAY;EACxB0B,QAAQ,EAAEjB,iBAAiB;EAE3BkB,cAAc,EAAE,KAAK;EACrBC,WAAW,EAAE;EACb;AACJ,CAAC;;AAGD;AACA;AACA;AACA;AACA,SAAS3B,OAAOA,CAAC4B,GAAG,EAAE;EAClB,OAAOC,MAAM,CAACC,IAAI,CAACF,GAAG,CAAC,CAACG,MAAM,KAAK,CAAC;AACxC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}